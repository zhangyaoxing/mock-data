# mock-data
This tool is a wrapper of the [Faker](https://faker.readthedocs.io/en/stable/index.html) library.

By defining a JSON schema and proper value description, it generates mock data for MongoDB in [EJSON](https://www.mongodb.com/docs/manual/reference/mongodb-extended-json/) format.

## 1 Dependencies
- Python 3.11.12
- Libraries:
```bash
pip install -r requirements.txt
```

## 2 How to Use
The tool utilizes [JSON schema](https://json-schema.org/), which is also used by MongoDB schema validator, to define data schema. Because JSON schema doesn't have the definition for values, we utlize the `description` field to define the values. The values can be generated by any of the [Faker](https://faker.readthedocs.io/en/stable/index.html) generator methods. 

### 2.1 Schema Definition
All schemas should be stored in `schemas` folder. The script will look for `.json` files in this folder.

In each schema file, you can define the following properties:
- `name`: Optional. Name of this schema. Defaults to the same as schema file name.
- `count`: Optional. How many mock documents should be generated. Defaults to `1`.
- `output`: Optional. Output file path. Defaults to `output/`.
- `$jsonSchema`: Required. The JSON schema. [JSON schema](https://json-schema.org/) is a 3rd-party standard for defining schemas for JSON. You can find details in the website. In the [MongoDB document](https://www.mongodb.com/docs/manual/reference/operator/query/jsonSchema/) you can also find some examples.

The following matrix shows which MongoDB data types are supported by this tool. Use `Alias` when you define the data types in the schema file.
|        Type        | Number |   Alias    | Supported |
|:------------------:|:------:|:----------:|:---------:|
|       Double       |   1    |   double   |  &check;  |
|       String       |   2    |   string   |  &check;  |
|       Object       |   3    |   object   |  &check;  |
|       Array        |   4    |   array    |  &check;  |
|    Binary data     |   5    |  binData   |  &check;  |
|      ObjectId      |   7    |  objectId  |  &check;  |
|      Boolean       |   8    |    bool    |  &check;  |
|        Date        |   9    |    date    |  &check;  |
|        Null        |   10   |    null    |  &check;  |
| Regular Expression |   11   |   regex    |  &cross;  |
|     JavaScript     |   13   | javascript |  &cross;  |
|   32-bit integer   |   16   |    int     |  &check;  |
|     Timestamp      |   17   | timestamp  |  &cross;  |
|   64-bit integer   |   18   |    long    |  &check;  |
|     Decimal128     |   19   |  decimal   |  &check;  |
|      Min key       |   -1   |   minKey   |  &cross;  |
|      Max key       |  127   |   maxKey   |  &cross;  |

### 2.2 Value Definition
When you define the schemas, fill in the `description` field an expression in this format: `#<method>(<params>)#`. (The `description` can have other text. This tool will only extract generator methods between 2 `#`.) If you don't need any parameters, you can omit the whole `(<params>)` or leave an empty `()`. These are some valid value descriptions:
- `#name#` or `#name()#`: Generate a random name using method [name](https://faker.readthedocs.io/en/stable/providers/faker.providers.person.html#faker.providers.person.Provider.name).
- `date_of_birth(None, 18, 25)`: Generate a random birthday using [date_of_birth](https://faker.readthedocs.io/en/stable/providers/faker.providers.date_time.html#faker.providers.date_time.Provider.date_of_birth). The age range is 18 to 25 years old.
- `#sentence(50)#`: Generate a random text with length 50 words using [sentence](https://faker.readthedocs.io/en/stable/providers/faker.providers.lorem.html#faker.providers.lorem.Provider.sentence).

To know which generator methods are available, checkout the [Standard Providers](https://faker.readthedocs.io/en/stable/providers.html) page, where you can find generator methods under each provider.

A full example can be found in [schemas/scores.json](https://github.com/zhangyaoxing/mock-data/blob/main/schemas/scores.json).

### 2.3 Output Providers
The tool supports output to several different destinations:
- To a file in [EJSON](https://www.mongodb.com/docs/manual/reference/mongodb-extended-json/) format.
- To a MongoDB collection.
- To a Kafka queue.

All providers are configured in the `/config.json` sub property `output`.

| Provider |          Property           |                                                                           Description                                                                           |
| :------: | :-------------------------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|  EJSON   |    `output.ejson.folder`    | **Required**. Configure the output folder. The tool will use the schema name as output name, with a `.ejson` suffix.                                            |
| MongoDB  |    `output.mongodb.uri`     | **Required**. Configure the MongoDB connection string. The tool will use the schema name as the output collection.                                              |
| MongoDB  | `output.mongodb.batch_size` | Optional. Configure the batch insert size. <br />If configuired, the tool will wait until it has enough documents, then use `insertMany` to insert all of them. |
|  Kafka   |     `output.kafka.uri`      | **Required**. (To be done)                                                                                                                                      |